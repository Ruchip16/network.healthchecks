---
- name: Starting Memory health check integration tests
  ansible.builtin.debug:
    msg: "START network.healthchecks.memory health check integration tests on connection={{ ansible_connection }}"

- name: Run memory health check validated content operation
  block:
    - name: Run network.memory validated content with memory health check operation
      ansible.builtin.include_role:
        name: network.healthchecks.memory
      vars:
        ansible_network_os: cisco.nxos.nxos
        memory_threshold: 80
        min_free_memory: 100
        min_buffers: 50
        min_cache: 50
      register: memory_result

    - name: Verify memory health check results
      ansible.builtin.assert:
        that:
          - memory_result.memory_health_checks.status == "successful"
        fail_msg: "Memory health check failed - Overall status is unsuccessful"

- name: Ending Memory health check integration tests
  ansible.builtin.debug:
    msg: "END network.healthchecks.memory health check integration tests on connection={{ ansible_connection }}"
